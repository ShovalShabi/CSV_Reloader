/**
 * The start time of the form submission process.
 * @type {Date}
 */
var startTime;

/**
 * The end time of the form submission process.
 * @type {Date}
 */
var endTime;

/**
 * The correctness set of the input fields.
 * @type {Set}
 */
var correctSet= new Set();

/**
 * The correctness set of the input fields.
 * @type {Set}
 */
var writtenSet= new Set();

/**
 * The button used to submit the form.
 * @type {HTMLButtonElement}
 */
var btn = document.getElementById("search-button");

/**
 * The label used to display the time it took to complete the form submission.
 * @type {HTMLLabelElement}
 */
var timeLabel = document.getElementById("time-label");

/**
 * The button used to open the popup.
 * @type {HTMLButtonElement}
 */
var popupBtn = document.getElementById("popupBtn");

/**
 * The button used to close the popup.
 * @type {HTMLButtonElement}
 */
var closeBtn = document.getElementById("close-button");

/**
 * Checks if the entered data exists in the given column of the reader JSON object.
 * @param {string} reader - The JSON object containing the data to check against.
 * @param {string} col - The column to search for the data in.
 * @param {Event} event - The event object of the input element.
 * @param {string} id - The ID of the element.
 */
function checkExistence(reader, col, event, id) {
    var input = event.target.value;
    var readerJSON = JSON.parse(reader);
    if (readerJSON[col].includes(input)) {
        btn.disabled = false;
        btn.style.backgroundColor = "#78c850";
        calculateTime();
        timeLabel.hidden = false;
        correctSet.add(id);
    } else {
        if (correctSet.has(id))
            correctSet.delete(id);

        if (input.length > 0)
            writtenSet.add(id);
        else
            writtenSet.delete(id);

        if(correctSet.size === 0){
            if (writtenSet.size > 0) {
                timeLabel.innerHTML = "Please enter the data correctly";
                timeLabel.hidden = false;
            } else {
                timeLabel.innerHTML = "";
                timeLabel.hidden = true;
                startTime = new Date();
            }

            btn.disabled = true;
            btn.style.backgroundColor = "#dddddd";
            stopSound();
        }
    }
}

/**
 * Changes the background color of the specified button on hover.
 * @param {string} id - The ID of the button to change.
 */
function specialHover(id) {
    switch(id) {
        case 'search-button':
            if (!btn.disabled) {
                btn.style.backgroundColor = "#63a040";
            }
            break;
        case 'popupBtn':
             if (!popupBtn.disabled) {
                popupBtn.style.backgroundColor = "#323ae8";
            }
            break;
        case 'close-button':
             if (!closeBtn.disabled) {
                closeBtn.style.backgroundColor = "#575e65";
            }
            break;
    }
}

/**
 * Resets the background color of the specified button after hover.
 * @param {string} id - The ID of the button to change.
 */
function resetHover(id) {
    switch(id) {
        case 'search-button':
            if (!btn.disabled) {
                btn.style.backgroundColor = "#78c850";
            }
            break;
        case 'popupBtn':
             if (!popupBtn.disabled) {
                popupBtn.style.backgroundColor = "#3275D5";
            }
            break;

        case 'close-button':
             if (!closeBtn.disabled) {
                closeBtn.style.backgroundColor = "#333333";
            }
            break;
    }
}

/**
 * Starts the timer to calculate the time it takes to complete the form submission.
 */
function startTimer() {
    startTime = new Date();
}

/**
 * Calculates the time it took to complete the form submission and displays it in the time label.
 */
function calculateTime() {
    endTime = new Date();
    var timeDiff = endTime - startTime;
    var seconds = timeDiff / 1000;
    timeLabel.innerHTML = "It took you " + seconds.toFixed(2) + "s";
}

/**
Function called when the form is submitted
@param {event} event - The event object generated by the submit event
@returns {boolean} Returns false to cancel the form submission
*/
function onSubmitForm(event) {
    event.preventDefault(); // cancel the form submission
    playSound();
    return false;
}

/**
Function that plays a sound and changes the background color of the popup button
*/
function playSound() {
    var audio = document.getElementById("myAudio");
    audio.volume = 0.7;
    audio.play();
    popupBtn.style.backgroundColor = "#3275D5";
    popupBtn.disabled = false;
}

/**
Function that stops the sound and resets the background color of the popup button
*/
function stopSound(){
    var audio = document.getElementById("myAudio");
    audio.pause();
    audio.currentTime = 0;
    popupBtn.style.backgroundColor = "#dddddd";
    popupBtn.disabled = true;
}

/**
Function that displays the overlay
*/
function openOverlay() {
    document.getElementById("overlay").style.display = "block";
}

/**
Function that hides the overlay
*/
function closeOverlay() {
    document.getElementById("overlay").style.display = "none";
}

/**
Event listener that starts the timer when the window loads
*/
window.addEventListener("load", function(){
    startTime = Date.now();
});